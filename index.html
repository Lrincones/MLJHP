<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Mljhp by Lrincones</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Mljhp</h1>
      <h2 class="project-tagline">Repository for John Hopkins Practical Machine Learning Course</h2>
      <a href="https://github.com/Lrincones/MLJHP" class="btn">View on GitHub</a>
      <a href="https://github.com/Lrincones/MLJHP/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Lrincones/MLJHP/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="---" class="anchor" href="#---" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>---</h1>

<p>title: "Practical Machine Learning"
author: "Luis Rincones"
date: "6 June 2016"</p>

<h2>
<a id="output-html_document" class="anchor" href="#output-html_document" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>output: html_document</h2>

<h2>
<a id="preparation" class="anchor" href="#preparation" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Preparation</h2>

<p>Prepare two data frames one for each file(training and testing)</p>

<p>Background for the variable classe
It corresponds to Unilateral Dumbbell Biceps Curl in five different fashions: according to the specification (Class A), throwing the elbows to the front (Class B), lifting the dumbbell only halfway (Class C), lowering the dumbbell only halfway (Class D) and throwing the hips to the front (Class E). Class A corresponds to the specified execution of the exercise, while the other 4 classes correspond to common mistakes. 
Generate an Histogram to see the frequencies of the classe variable.</p>

<p>Eliminate the features with NA, from both sets(training and testing)
Eliminate some features that don't contribute to the model we are planning to create</p>

<h2>
<a id="summary" class="anchor" href="#summary" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Summary</h2>

<p>After reviewing the available information in the site for the "Human Activity Recognition", in particular the document available in
"<a href="http://groupware.les.inf.puc-rio.br/public/papers/2013.Velloso.QAR-WLE.pdf">http://groupware.les.inf.puc-rio.br/public/papers/2013.Velloso.QAR-WLE.pdf</a>".
The strategy was based in generating 4 subsets one for each sensor;
ARM, BELT, DUMBBELLL and FOREARM.
The goal was to seek the features that were common among all sensors with a significant contribution to their corresponding model. With this set of features, a new model will be created for prediction. Our requirements were to have a much smaller set of features than the original 159 (without classe). We would like to have fewer than 16 (an empiric number to make the computational times acceptable) </p>

<p>For each sensor a model was built the corresponding rfcv was used to assist in checking the model.</p>

<h2>
<a id="libraries" class="anchor" href="#libraries" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Libraries</h2>

<div class="highlight highlight-source-r"><pre>library(<span class="pl-smi">caret</span>)
library(<span class="pl-smi">randomForest</span>)</pre></div>

<h2>
<a id="preparation-1" class="anchor" href="#preparation-1" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Preparation</h2>

<p>After downloading the files and creating the Data Frames, generate an Histogram of the Variable classe for the training set.</p>

<div class="highlight highlight-source-r"><pre>set.seed(<span class="pl-c1">1947</span>)
download.file(<span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>training.csv<span class="pl-pds">"</span></span>)
download.file(<span class="pl-s"><span class="pl-pds">"</span>https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>testing.csv<span class="pl-pds">"</span></span>)
<span class="pl-v">training</span> <span class="pl-k">=</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>training.csv<span class="pl-pds">"</span></span>)
<span class="pl-v">testing</span> <span class="pl-k">=</span> read.csv(<span class="pl-s"><span class="pl-pds">"</span>testing.csv<span class="pl-pds">"</span></span>)
barplot(summary(<span class="pl-smi">training</span><span class="pl-k">$</span><span class="pl-smi">classe</span>))
<span class="pl-smi">count_na</span> <span class="pl-k">&lt;-</span>sapply(<span class="pl-smi">training</span>, <span class="pl-k">function</span>(<span class="pl-smi">y</span>) sum(length(which(is.na(<span class="pl-smi">y</span>)))))
<span class="pl-smi">list_na</span> <span class="pl-k">&lt;-</span> which(<span class="pl-smi">count_na</span> <span class="pl-k">&gt;</span> <span class="pl-c1">0</span>) 
<span class="pl-smi">training_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training</span>[,<span class="pl-k">-</span><span class="pl-smi">list_na</span>] 
<span class="pl-smi">testing_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testing</span>[,<span class="pl-k">-</span><span class="pl-smi">list_na</span>]
<span class="pl-smi">training_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training_small</span>[,<span class="pl-k">-</span>c(<span class="pl-c1">1</span>,<span class="pl-c1">3</span><span class="pl-k">:</span><span class="pl-c1">7</span>)]
<span class="pl-smi">testing_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">testing_small</span>[,<span class="pl-k">-</span>c(<span class="pl-c1">1</span>,<span class="pl-c1">3</span><span class="pl-k">:</span><span class="pl-c1">7</span>)]
<span class="pl-smi">nombres</span> <span class="pl-k">&lt;-</span> colnames(<span class="pl-smi">training_small</span>)</pre></div>

<h2>
<a id="sensors-data-frame" class="anchor" href="#sensors-data-frame" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Sensors Data Frame</h2>

<p>As indicated before we will divide the training Data Frame in  4 sets with a smaller number of features each.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c">### Recall RandomForest </span>
<span class="pl-c">### Can not handle categorical predictors with more than 53 categories.</span>
<span class="pl-c"># Sensor ARM</span>
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> grep(<span class="pl-s"><span class="pl-pds">"</span>_arm<span class="pl-pds">"</span></span>,<span class="pl-smi">nombres</span>, <span class="pl-v">ignore.case</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> append(<span class="pl-smi">temp</span>, <span class="pl-c1">87</span>, <span class="pl-v">after</span><span class="pl-k">=</span>length(<span class="pl-smi">temp</span>))
<span class="pl-smi">t_arm</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training_small</span>[,<span class="pl-smi">temp</span>]
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">t_arm</span>, <span class="pl-k">function</span>(<span class="pl-smi">y</span>) which(nlevels(<span class="pl-smi">y</span>) <span class="pl-k">&lt;</span><span class="pl-k">=</span> <span class="pl-c1">50</span>))
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> as.logical(<span class="pl-smi">count_factors</span>)
<span class="pl-smi">count_factors</span>[is.na(<span class="pl-smi">count_factors</span>)] <span class="pl-k">&lt;-</span> <span class="pl-c1">FALSE</span>
<span class="pl-smi">t_arm_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">t_arm</span>[,<span class="pl-smi">count_factors</span>] 
<span class="pl-smi">t_arm_modFit</span> <span class="pl-k">&lt;-</span> randomForest(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-smi">t_arm_small</span>, <span class="pl-v">importance</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
<span class="pl-c"># Sensor BELT</span>
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> grep(<span class="pl-s"><span class="pl-pds">"</span>_belt<span class="pl-pds">"</span></span>,<span class="pl-smi">nombres</span>, <span class="pl-v">ignore.case</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> append(<span class="pl-smi">temp</span>, <span class="pl-c1">87</span>, <span class="pl-v">after</span><span class="pl-k">=</span>length(<span class="pl-smi">temp</span>))
<span class="pl-smi">t_belt</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training_small</span>[,<span class="pl-smi">temp</span>]
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">t_belt</span>, <span class="pl-k">function</span>(<span class="pl-smi">y</span>) which(nlevels(<span class="pl-smi">y</span>) <span class="pl-k">&lt;</span><span class="pl-k">=</span> <span class="pl-c1">50</span>))
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> as.logical(<span class="pl-smi">count_factors</span>)
<span class="pl-smi">count_factors</span>[is.na(<span class="pl-smi">count_factors</span>)] <span class="pl-k">&lt;-</span> <span class="pl-c1">FALSE</span>
<span class="pl-smi">t_belt_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">t_belt</span>[,<span class="pl-smi">count_factors</span>] 
<span class="pl-smi">t_belt_modFit</span> <span class="pl-k">&lt;-</span> randomForest(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-smi">t_belt_small</span>, <span class="pl-v">importance</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
<span class="pl-c"># SENSOR DUMBBELLL</span>
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> grep(<span class="pl-s"><span class="pl-pds">"</span>_dumbbell<span class="pl-pds">"</span></span>,<span class="pl-smi">nombres</span>, <span class="pl-v">ignore.case</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> append(<span class="pl-smi">temp</span>, <span class="pl-c1">87</span>, <span class="pl-v">after</span><span class="pl-k">=</span>length(<span class="pl-smi">temp</span>))
<span class="pl-smi">t_dumbbell</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training_small</span>[,<span class="pl-smi">temp</span>]
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">t_dumbbell</span>, <span class="pl-k">function</span>(<span class="pl-smi">y</span>) which(nlevels(<span class="pl-smi">y</span>) <span class="pl-k">&lt;</span><span class="pl-k">=</span> <span class="pl-c1">50</span>))
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> as.logical(<span class="pl-smi">count_factors</span>)
<span class="pl-smi">count_factors</span>[is.na(<span class="pl-smi">count_factors</span>)] <span class="pl-k">&lt;-</span> <span class="pl-c1">FALSE</span>
<span class="pl-smi">t_dumbbell_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">t_dumbbell</span>[,<span class="pl-smi">count_factors</span>] 
<span class="pl-smi">t_dumbbell_modFit</span> <span class="pl-k">&lt;-</span> randomForest(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-smi">t_dumbbell_small</span>, <span class="pl-v">importance</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
<span class="pl-c"># SENSOR FOREARM</span>
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> grep(<span class="pl-s"><span class="pl-pds">"</span>_forearm<span class="pl-pds">"</span></span>,<span class="pl-smi">nombres</span>, <span class="pl-v">ignore.case</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-smi">temp</span> <span class="pl-k">&lt;-</span> append(<span class="pl-smi">temp</span>, <span class="pl-c1">87</span>, <span class="pl-v">after</span><span class="pl-k">=</span>length(<span class="pl-smi">temp</span>))
<span class="pl-smi">t_forearm</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training_small</span>[,<span class="pl-smi">temp</span>]
<span class="pl-smi">t_forearm</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training_small</span>[,<span class="pl-smi">temp</span>]
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> sapply(<span class="pl-smi">t_forearm</span>, <span class="pl-k">function</span>(<span class="pl-smi">y</span>) which(nlevels(<span class="pl-smi">y</span>) <span class="pl-k">&lt;</span><span class="pl-k">=</span> <span class="pl-c1">50</span>))
<span class="pl-smi">count_factors</span> <span class="pl-k">&lt;-</span> as.logical(<span class="pl-smi">count_factors</span>)
<span class="pl-smi">count_factors</span>[is.na(<span class="pl-smi">count_factors</span>)] <span class="pl-k">&lt;-</span> <span class="pl-c1">FALSE</span>
<span class="pl-smi">t_forearm_small</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">t_forearm</span>[,<span class="pl-smi">count_factors</span>] 
<span class="pl-smi">t_forearm_modFit</span> <span class="pl-k">&lt;-</span> randomForest(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-smi">t_dumbbell_small</span>, <span class="pl-v">importance</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
</pre></div>

<h2>
<a id="analysis" class="anchor" href="#analysis" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Analysis</h2>

<p>Review the features importance for each of the sensor's set.
Generate the Random Forest Cross-Validation for feature selection (rfcv)</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># Listing and Analyzing the features for each sensor's model</span>
sort(<span class="pl-smi">t_arm_modFit</span><span class="pl-k">$</span><span class="pl-smi">importance</span>[,<span class="pl-c1">7</span>], <span class="pl-v">decreasing</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
sort(<span class="pl-smi">t_belt_modFit</span><span class="pl-k">$</span><span class="pl-smi">importance</span>[,<span class="pl-c1">7</span>], <span class="pl-v">decreasing</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
sort(<span class="pl-smi">t_dumbbell_modFit</span><span class="pl-k">$</span><span class="pl-smi">importance</span>[,<span class="pl-c1">7</span>], <span class="pl-v">decreasing</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
sort(<span class="pl-smi">t_forearm_modFit</span><span class="pl-k">$</span><span class="pl-smi">importance</span>[,<span class="pl-c1">7</span>], <span class="pl-v">decreasing</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
colnames(<span class="pl-smi">t_arm_small</span>)
colnames(<span class="pl-smi">t_belt_small</span>)
colnames(<span class="pl-smi">t_dumbbell_small</span>)
colnames(<span class="pl-smi">t_forearm_small</span>)
<span class="pl-smi">t_arm_rfcv</span> <span class="pl-k">&lt;-</span> rfcv(<span class="pl-v">trainx</span><span class="pl-k">=</span><span class="pl-smi">t_arm_small</span>[,<span class="pl-k">-</span><span class="pl-c1">14</span>], <span class="pl-v">trainy</span> <span class="pl-k">=</span> <span class="pl-smi">t_arm_small</span>[,<span class="pl-c1">14</span>], <span class="pl-v">scale</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>log<span class="pl-pds">"</span></span>, <span class="pl-v">step</span><span class="pl-k">=</span><span class="pl-c1">0.5</span>)
<span class="pl-smi">t_belt_rfcv</span> <span class="pl-k">&lt;-</span> rfcv(<span class="pl-v">trainx</span><span class="pl-k">=</span><span class="pl-smi">t_belt_small</span>[,<span class="pl-k">-</span><span class="pl-c1">17</span>], <span class="pl-v">trainy</span> <span class="pl-k">=</span> <span class="pl-smi">t_belt_small</span>[,<span class="pl-c1">17</span>], <span class="pl-v">scale</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>log<span class="pl-pds">"</span></span>, <span class="pl-v">step</span><span class="pl-k">=</span><span class="pl-c1">0.5</span>)
<span class="pl-smi">t_dumbbell_rfcv</span> <span class="pl-k">&lt;-</span> rfcv(<span class="pl-v">trainx</span><span class="pl-k">=</span><span class="pl-smi">t_dumbbell_small</span>[,<span class="pl-k">-</span><span class="pl-c1">17</span>], <span class="pl-v">trainy</span> <span class="pl-k">=</span> <span class="pl-smi">t_dumbbell_small</span>[,<span class="pl-c1">17</span>], <span class="pl-v">scale</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>log<span class="pl-pds">"</span></span>, <span class="pl-v">step</span><span class="pl-k">=</span><span class="pl-c1">0.5</span>)
<span class="pl-smi">t_forearm_rfcv</span> <span class="pl-k">&lt;-</span> rfcv(<span class="pl-v">trainx</span><span class="pl-k">=</span><span class="pl-smi">t_forearm_small</span>[,<span class="pl-k">-</span><span class="pl-c1">19</span>], <span class="pl-v">trainy</span> <span class="pl-k">=</span> <span class="pl-smi">t_forearm_small</span>[,<span class="pl-c1">19</span>], <span class="pl-v">scale</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>log<span class="pl-pds">"</span></span>, <span class="pl-v">step</span><span class="pl-k">=</span><span class="pl-c1">0.5</span>)</pre></div>

<h2>
<a id="final-model" class="anchor" href="#final-model" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Final Model</h2>

<p>After the analysis, the features we found as significant and common were the "magnet" for each of the 3 dimensions(x,y,z) and from each of the four sensors. Those had the more consistent behavior with our goals
We now create a training set with only those features. 
It is important to mention that for the belt sensor, the magnet group were the second set of features, the first 3 places were (yaw_belt, roll_belt and pitch_belt). 
For lack of time, considering this as part of the Final Model, will be done in future versions.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-c"># after analysis the features chosen as a common group were</span>
<span class="pl-smi">temp1</span> <span class="pl-k">&lt;-</span> grep(<span class="pl-s"><span class="pl-pds">"</span>magnet<span class="pl-pds">"</span></span>,<span class="pl-smi">nombres</span>, <span class="pl-v">ignore.case</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-smi">temp1</span> <span class="pl-k">&lt;-</span> grep(<span class="pl-s"><span class="pl-pds">"</span>magnet<span class="pl-pds">"</span></span>,<span class="pl-smi">nombres</span>, <span class="pl-v">ignore.case</span> <span class="pl-k">=</span> <span class="pl-c1">TRUE</span>)
<span class="pl-smi">temp1</span> <span class="pl-k">&lt;-</span> append(<span class="pl-smi">temp1</span>, <span class="pl-c1">87</span>, <span class="pl-v">after</span><span class="pl-k">=</span>length(<span class="pl-smi">temp1</span>))
<span class="pl-smi">t_final</span> <span class="pl-k">&lt;-</span> <span class="pl-smi">training_small</span>[,<span class="pl-smi">temp1</span>]
dim(<span class="pl-smi">t_final</span>)
colnames(<span class="pl-smi">t_final</span>)
<span class="pl-smi">t_final_modFit</span> <span class="pl-k">&lt;-</span> randomForest(<span class="pl-smi">classe</span> <span class="pl-k">~</span> ., <span class="pl-smi">t_final</span>, <span class="pl-v">importance</span><span class="pl-k">=</span><span class="pl-c1">TRUE</span>)
<span class="pl-smi">t_final_modFit</span><span class="pl-k">$</span><span class="pl-smi">confusion</span>
<span class="pl-smi">t_final_modFit</span><span class="pl-k">$</span><span class="pl-smi">importance</span>
<span class="pl-smi">t_rfcv</span> <span class="pl-k">&lt;-</span> rfcv(<span class="pl-v">trainx</span><span class="pl-k">=</span><span class="pl-smi">t_final</span>[,<span class="pl-k">-</span><span class="pl-c1">13</span>], <span class="pl-v">trainy</span> <span class="pl-k">=</span> <span class="pl-smi">t_final</span>[,<span class="pl-c1">13</span>], <span class="pl-v">scale</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>log<span class="pl-pds">"</span></span>, <span class="pl-v">step</span><span class="pl-k">=</span><span class="pl-c1">0.7</span>)
<span class="pl-smi">t_rfcv</span><span class="pl-k">$</span><span class="pl-smi">error.cv</span></pre></div>

<h2>
<a id="prediction" class="anchor" href="#prediction" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Prediction</h2>

<p>As required the prediction using the testing as newdata.
Results are indicate below.</p>

<div class="highlight highlight-source-r"><pre><span class="pl-smi">t_prediction</span> <span class="pl-k">&lt;-</span> predict(<span class="pl-smi">t_final_modFit</span>, <span class="pl-v">newdata</span> <span class="pl-k">=</span> <span class="pl-smi">testing_small</span>)
<span class="pl-smi">t_prediction</span></pre></div>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Lrincones/MLJHP">Mljhp</a> is maintained by <a href="https://github.com/Lrincones">Lrincones</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
